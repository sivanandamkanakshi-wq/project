<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BusTicketPro - Online Bus Booking</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* [Previous CSS code remains the same until seat selection section] */

        /* Step 3: Seat Selection - Optimized Layout for Mobile */
        .seat-layout {
            background: #f8f9fa;
            border-radius: var(--radius);
            padding: 1.5rem;
            margin: 1.5rem 0;
            overflow-x: auto;
        }

        .driver-seat {
            background: var(--gray);
            color: white;
            padding: 0.8rem;
            border-radius: var(--radius);
            margin-bottom: 1.5rem;
            width: 180px;
            margin: 0 auto 1.5rem;
            text-align: center;
            font-size: 0.9rem;
        }

        .seat-container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .seat-row {
            display: flex;
            gap: 1rem;
            justify-content: center;
            align-items: center;
        }

        .left-seats, .right-seats {
            display: flex;
            gap: 0.8rem;
            flex: 1;
        }

        .aisle {
            width: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray);
            font-size: 0.9rem;
        }

        .seat {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .seat.available {
            background: #e8f5e9;
            color: var(--green);
            border: 2px solid #c8e6c9;
        }

        .seat.selected {
            background: linear-gradient(135deg, var(--accent), var(--green));
            color: white;
            border: 2px solid var(--accent);
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .seat.booked {
            background: #ffebee;
            color: var(--danger);
            border: 2px solid #ffcdd2;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .seat.women {
            background: #f3e5f5;
            border: 2px solid #ce93d8;
        }

        .seat.available:hover {
            background: #c8e6c9;
            transform: scale(1.05);
        }

        /* Last row seats - full width */
        .last-row {
            display: flex;
            justify-content: center;
            gap: 0.8rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .seat-legend {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin: 2rem 0;
            flex-wrap: wrap;
            padding: 1rem;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid rgba(0,0,0,0.1);
        }

        /* Booking Summary - Mobile Optimized */
        .booking-summary {
            background: linear-gradient(135deg, #f8f9fa, #ffffff);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin: 1.5rem 0;
            box-shadow: var(--shadow);
        }

        .selected-seats-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 1rem 0;
            min-height: 50px;
            align-items: center;
        }

        .seat-tag {
            background: linear-gradient(to right, var(--accent), var(--green));
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        /* Mobile Responsive Improvements */
        @media (max-width: 768px) {
            .seat-layout {
                padding: 1rem;
                margin: 1rem 0;
            }
            
            .seat-container {
                gap: 1rem;
            }
            
            .seat-row {
                gap: 0.5rem;
            }
            
            .left-seats, .right-seats {
                gap: 0.5rem;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .seat {
                width: 45px;
                height: 45px;
                font-size: 0.85rem;
            }
            
            .aisle {
                width: 30px;
                font-size: 0.8rem;
            }
            
            .last-row {
                gap: 0.5rem;
            }
            
            .seat-legend {
                gap: 1rem;
                padding: 0.8rem;
                margin: 1.5rem 0;
            }
            
            .legend-item {
                font-size: 0.8rem;
            }
            
            .legend-color {
                width: 16px;
                height: 16px;
            }
            
            .driver-seat {
                width: 150px;
                padding: 0.6rem;
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .seat {
                width: 40px;
                height: 40px;
                font-size: 0.8rem;
            }
            
            .seat-row {
                flex-direction: column;
                align-items: center;
            }
            
            .left-seats, .right-seats {
                width: 100%;
                justify-content: center;
            }
            
            .aisle {
                width: 100%;
                height: 20px;
                justify-content: center;
                font-size: 0.8rem;
                color: var(--gray);
            }
            
            .seat-tag {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }
            
            .seat-legend {
                gap: 0.8rem;
                justify-content: flex-start;
            }
        }
    </style>
</head>
<body>
    <!-- [Previous HTML code remains the same until seat selection step] -->

    <!-- Step 3: Seat Selection -->
    <div class="step-container" id="seat-selection-step">
        <h2 class="section-title">
            <i class="fas fa-chair"></i> Select Seats
            <span id="selected-bus-info" style="font-size: 1rem; color: var(--gray);"></span>
        </h2>
        
        <div class="seat-layout">
            <div class="driver-seat">
                <i class="fas fa-bus"></i> Driver's Cabin
            </div>
            
            <div class="seat-container" id="seat-container">
                <!-- Seat rows will be generated by JavaScript -->
            </div>
            
            <div class="seat-legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #e8f5e9;"></div>
                    <span>Available</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, var(--accent), var(--green));"></div>
                    <span>Selected</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #ffebee;"></div>
                    <span>Booked</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f3e5f5;"></div>
                    <span>Women Only</span>
                </div>
            </div>
        </div>
        
        <div class="booking-summary">
            <h3 style="color: var(--primary); margin-bottom: 1rem;">
                <i class="fas fa-ticket-alt"></i> Selected Seats
            </h3>
            <div class="selected-seats-list" id="selected-seats-list">
                <!-- Selected seats will appear here -->
            </div>
            <div class="summary-total">
                Total: â‚¹<span id="total-price">0</span>
            </div>
        </div>
        
        <div class="action-buttons">
            <button class="btn-secondary" onclick="goToStep('bus-list-step')">
                <i class="fas fa-arrow-left"></i> Back to Bus List
            </button>
            <button class="select-btn" onclick="goToStep('passenger-details-step')">
                <i class="fas fa-users"></i> Continue to Passenger Details
            </button>
        </div>
    </div>

    <!-- [Rest of the HTML remains the same] -->

    <script>
        // [Previous JavaScript code remains the same until generateSeatMap function]

        // Generate optimized seat map with 2x2 layout
        function generateSeatMap() {
            const seatContainer = document.getElementById('seat-container');
            if (!selectedBus || !seatContainer) return;
            
            const totalSeats = selectedBus.seats;
            const bookedSeats = selectedBus.bookedSeats;
            const womenSeats = selectedBus.womenSeats;
            
            seatContainer.innerHTML = '';
            selectedSeats = [];
            
            // Calculate rows (4 seats per row: 2 left + 2 right)
            const seatsPerRow = 4;
            const regularRows = Math.floor((totalSeats - 5) / seatsPerRow); // Last row has 5 seats
            const remainingSeats = totalSeats - (regularRows * seatsPerRow);
            
            let seatNumber = 1;
            
            // Create regular rows (2x2 layout)
            for (let row = 0; row < regularRows; row++) {
                const seatRow = document.createElement('div');
                seatRow.className = 'seat-row';
                
                // Left seats (2 seats)
                const leftSeats = document.createElement('div');
                leftSeats.className = 'left-seats';
                
                for (let i = 0; i < 2; i++) {
                    if (seatNumber > totalSeats) break;
                    leftSeats.appendChild(createSeatElement(seatNumber, bookedSeats, womenSeats));
                    seatNumber++;
                }
                
                // Aisle gap
                const aisle = document.createElement('div');
                aisle.className = 'aisle';
                aisle.innerHTML = '<i class="fas fa-walking"></i>';
                
                // Right seats (2 seats)
                const rightSeats = document.createElement('div');
                rightSeats.className = 'right-seats';
                
                for (let i = 0; i < 2; i++) {
                    if (seatNumber > totalSeats) break;
                    rightSeats.appendChild(createSeatElement(seatNumber, bookedSeats, womenSeats));
                    seatNumber++;
                }
                
                seatRow.appendChild(leftSeats);
                seatRow.appendChild(aisle);
                seatRow.appendChild(rightSeats);
                seatContainer.appendChild(seatRow);
            }
            
            // Create last row with 5 seats (centered)
            if (remainingSeats > 0) {
                const lastRow = document.createElement('div');
                lastRow.className = 'last-row';
                
                for (let i = 0; i < Math.min(remainingSeats, 5); i++) {
                    if (seatNumber > totalSeats) break;
                    lastRow.appendChild(createSeatElement(seatNumber, bookedSeats, womenSeats));
                    seatNumber++;
                }
                
                seatContainer.appendChild(lastRow);
            }
            
            updateSelectedSeatsDisplay();
        }

        // Helper function to create seat element
        function createSeatElement(seatNumber, bookedSeats, womenSeats) {
            const seat = document.createElement('div');
            seat.className = 'seat';
            seat.id = `seat-${seatNumber}`;
            
            // Determine seat type
            if (bookedSeats.includes(seatNumber)) {
                seat.classList.add('booked');
                seat.innerHTML = `<i class="fas fa-ban"></i>`;
                seat.title = `Seat ${seatNumber} - Booked`;
            } else if (womenSeats.includes(seatNumber)) {
                seat.classList.add('women', 'available');
                seat.innerHTML = `<div class="seat-number">${seatNumber}</div>`;
                seat.title = `Seat ${seatNumber} - Women Only`;
            } else {
                seat.classList.add('available');
                seat.innerHTML = `<div class="seat-number">${seatNumber}</div>`;
                seat.title = `Seat ${seatNumber} - Available`;
            }
            
            // Add click event for available seats
            if (!bookedSeats.includes(seatNumber)) {
                seat.addEventListener('click', () => toggleSeat(seatNumber));
            }
            
            return seat;
        }

        // Toggle seat selection
        function toggleSeat(seatNumber) {
            const seatElement = document.getElementById(`seat-${seatNumber}`);
            const index = selectedSeats.indexOf(seatNumber);
            
            if (index === -1) {
                // Maximum 6 seats per booking
                if (selectedSeats.length >= 6) {
                    showNotification('Maximum 6 seats per booking!', 'info');
                    return;
                }
                selectedSeats.push(seatNumber);
                seatElement.classList.add('selected');
                seatElement.classList.remove('available', 'women');
            } else {
                selectedSeats.splice(index, 1);
                seatElement.classList.remove('selected');
                if (selectedBus.womenSeats.includes(seatNumber)) {
                    seatElement.classList.add('women');
                } else {
                    seatElement.classList.add('available');
                }
            }
            
            updateSelectedSeatsDisplay();
        }

        // Update selected seats display
        function updateSelectedSeatsDisplay() {
            const selectedSeatsList = document.getElementById('selected-seats-list');
            const totalPrice = document.getElementById('total-price');
            
            if (selectedSeats.length === 0) {
                selectedSeatsList.innerHTML = '<span style="color: var(--gray); font-style: italic;">No seats selected yet</span>';
            } else {
                selectedSeatsList.innerHTML = selectedSeats.map(seat => `
                    <div class="seat-tag">
                        <i class="fas fa-chair"></i> Seat ${seat}
                    </div>
                `).join('');
            }
            
            const total = selectedSeats.length * (selectedBus ? selectedBus.price : 0);
            totalPrice.textContent = total;
        }

        // [Rest of the JavaScript code remains the same]
    </script>
</body>
</html>